<% content_for :title do   %>
  <ol class="th breadcrumb">
    <li>Mail</li>
    <li><%= link_to 'Domains', domains_path %></li>
  </ol>
<% end %>
<% content_for :section do %>Domain <%= @domain.domain %><% end %>

<div class="pull-right">
  <div class="btn-group">
    <% if can? :update, @domain %>
      <%= link_to edit_domain_path(@domain), :class => 'btn btn-secondary btn-sm', :title => 'Edit domain', :data => {:toggle => 'tooltip'}  do %>
        <i class="fa fa-pencil"></i>
      <% end %>
    <% end %>
    <% if can? :destroy, @domain %>
      <%= link_to domain_path(@domain),
                            :method => :delete,
                            :title => 'Delete domain',
                            data: { confirm: 'Are you sure you want to delete this domain?',
                                    :toggle => 'tooltip' },
                            :class => 'btn btn-secondary btn-sm' do %>
        <i class="fa fa-trash"></i>
      <% end %>
    <% end %>
  </div>
</div>

<table class="th attribute-table">
  <tr>
    <td>Domain</td>
    <td><%= @domain.domain %></td>
  </tr>
</table>

<div class="title-heading">
  <h3>Domain aliases</h3>
</div>

<div class="pull-right">
  <% if can? :create, DomainAlias %>
    <%= link_to new_domain_alias_path(:params => {:domain => @domain.domain}),
                            :class => 'btn btn-secondary btn-sm',
                            :title => 'Add domain alias',
                            :data => { :toggle => 'tooltip' } do %>
      <i class="fa fa-plus"></i>
    <% end %>
  <% end %>
</div>

<div class="row">
  <div class="col-xs-6">
    <% if @domain_aliases.nil? %>
      <em>No domain aliases found</em>
    <% else %>
      <table class="th table">
        <thead>
          <tr>
            <th>Alias</th>
          </tr>
        </thead>
        <tbody>
          <% @domain_aliases.each do |domain_alias| %>
            <tr>
              <td><%= link_to domain_alias.alias, domain_alias_path(domain_alias) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</div>

<div class="title-heading">
  <h3>Emails</h3>
</div>

<div class="pull-right">
  <% if can? :create, Email %>
        <%= link_to new_domain_email_path(@domain),
                            :class => 'btn btn-secondary btn-sm',
                            :title => 'Add email',
                            :data => { :toggle => 'tooltip' } do %>
      <i class="fa fa-plus"></i>
    <% end %>
  <% end %>
</div>

<% if @domain.emails.any? %>
  <table class="th table">
    <thead>
      <tr>
        <th>Email</th>
        <th>Owner</th>
        <th>Members</th>
      </tr>
    </thead>
    <tbody>
      <% @domain.emails.each do |email| %>
        <tr>
          <td>
            <%= link_to email, domain_email_path(@domain, email) %>
          </td>
          <% if email.permission_group.nil? %>
            <td colspan="2" class="text-center">
              <i class="fa fa-exclamation-triangle" data-toggle="tooltip" data-placement="top" title="This email does not have an associated permission group"></i>
            </td>
          <% else %>
            <td>
              <% if email.permission_group.owner.nil? %>
                <em>No current owner</em>
              <% else %>
                <%= link_to email.permission_group.owner.display_name, user_path(email.owner) %>
              <% end %>
            </td>
            <td>
              <%= pluralize(email.permission_group.users.count, 'member') %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <em>No emails found</em>
<% end %>
