<% content_for :title do   %>
  <ol class="th breadcrumb">
    <li>Accounts</li>
    <li><%= link_to 'Groups', groups_path %></li>
  </ol>
<% end %>
<% content_for :section do %>Group <%= @group.name %><% end %>

<div class="pull-right">
  <div class="btn-group">
    <% if can? :update, @group %>
      <%= link_to edit_group_path(@group), :class => 'btn btn-secondary btn-sm', :title => 'Edit group', :data => {:toggle => 'tooltip'}  do %>
        <i class="fa fa-pencil"></i>
      <% end %>
    <% end %>
    <% if can? :destroy, @group %>
      <%= link_to group_path(@group),
                            :method => :delete,
                            :title => 'Delete group',
                            data: { confirm: 'Are you sure you want to delete this group?',
                                    :toggle => 'tooltip' },
                            :class => 'btn btn-secondary btn-sm' do %>
        <i class="fa fa-trash"></i>
      <% end %>
    <% end %>
  </div>
</div>

<div class="row">
  <table class="th attribute-table">
    <tr>
      <td>Name</td>
      <td><%= @group.name %></td>
    </tr>
    <tr>
      <td>Display name</td>
      <td><%= @group.display_name %></td>
    </tr>
    <tr>
      <td>Owner</td>
      <td>
        <% if @group.owner %>
          <%= link_to @group.owner.display_name, user_path(@group.owner) %>
        <% else %>
          <em>No current owner</em>
        <% end %>
      </td>
    </tr>
  </table>
</div>

<div class="title-heading">
  <h3>Members</h3>
</div>

<div class="row">
  <div class="col-xs-8">
    <table class="th table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <% if @group.users.empty? %>
          <tr>
            <td colspan="3" class="text-center">
              <em>No members found</em>
            </td>
          </tr>
        <% else %>
          <% @group.users.each do |member| %>
            <tr>
              <td><%= link_to member.display_name, user_path(member) %></td>
              <td><%= @group.owner == member ? 'Owner' : 'Member' %></td>
              <% if can? :update, @group %>
                <td>
                  <% if @group.owner != member %>
                    <%= link_to group_user_path(@group, :id => member.id), method: :delete, :title => 'Remove member', :data => { :toggle => 'tooltip' } do %>
                      <i class="fa fa-times"></i>
                    <% end %>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if can? :update, @group %>
    <% if (@users - @group.users).any? %>
      <div class="col-xs-4">
        <%= form_for :user, url: group_users_path(@group) do |f| %>
          <label class="th dropdown">
            <%= f.select :id, @users.reject { |u| @group.users.include? u }.collect { |u| [ u.display_name, u.id ] } %>
          </label>
          <%= f.submit 'Add', :class => "btn btn-sm btn-secondary" %>
        <% end %>
      </div>
    <% else %>
      <em>All visible users belong to this group</em>
    <% end %>
  <% end %>
</div>

<div class="title-heading">
  <h3>Services</h3>
</div>

<div class="row">
  <div class="col-xs-8">
    <table class="th table">
      <thead>
        <tr>
          <th>Name</th>
        </tr>
      </thead>
      <tbody>
        <% if @group.services.empty? %>
          <tr>
            <td colspan="3" class="text-center">
              <em>No services found</em>
            </td>
          </tr>
        <% else %>
          <% @group.services.each do |service| %>
            <tr>
              <td><%= link_to service.display_name, service_path(service) %></td>
              <% if can? :update, @group %>
                <td>
                  <%= link_to group_service_path(@group, :id => service.id), method: :delete, :title => 'Remove service', :data => { :toggle => 'tooltip' } do %>
                    <i class="fa fa-times"></i>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if can? :update, @group %>
    <% if (@services - @group.services).any? %>
      <div class="col-xs-4">
        <%= form_for :service, url: group_services_path(@group) do |f| %>
          <label class="th dropdown">
            <%= f.select :id, @services.reject { |u| @group.services.include? u }.collect { |u| [ u.display_name, u.id ] } %>
          </label>
          <%= f.submit 'Add', :class => "btn btn-sm btn-secondary" %>
        <% end %>
      </div>
    <% else %>
      <em>All services belong to this group</em>
    <% end %>
  <% end %>
</div>
